<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Menü Yönetimi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .category {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
    }
    .category input[type="text"] {
      width: 100%;
      padding: 6px;
      margin-bottom: 0.5rem;
    }
    .item {
      background: #f1f1f1;
      padding: 0.75rem;
      border-radius: 5px;
      margin-bottom: 0.5rem;
    }
    .item input[type="text"] {
      width: 100%;
      padding: 6px;
      margin-bottom: 0.25rem;
    }
    button {
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    .remove-btn {
      background: #e74c3c;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Menü Yönetim Paneli</h1>
  <div id="menuContainer"></div>
  <button onclick="addCategory()">Kategori Ekle</button>
  <button onclick="saveMenu()">Kaydet ve Yayınla</button>
  <p id="status"></p>

  <script>
    const OWNER = "YOUR_GITHUB_USERNAME";
    const REPO = "YOUR_REPO";
    const FILE_PATH = "menu_data.json";
    const BRANCH = "main";
    let token = localStorage.getItem('gh_token') || prompt("GitHub Token:");
    if (token) localStorage.setItem('gh_token', token);

    let menuData = {};
    let sha = "";

    async function loadMenu() {
      const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}?ref=${BRANCH}`, {
        headers: { Authorization: "token " + token }
      });
      const data = await res.json();
      sha = data.sha;
      menuData = JSON.parse(atob(data.content));
      renderMenu();
    }

    function renderMenu() {
      const container = document.getElementById("menuContainer");
      container.innerHTML = "";
      for (let category in menuData) {
        const catDiv = document.createElement("div");
        catDiv.className = "category";
        catDiv.innerHTML = `
          <input type="text" placeholder="Kategori Adı" value="${category}" data-category>
          <input type="text" placeholder="Kategori Görseli" value="${menuData[category].image}" data-image>
          <div class="items"></div>
          <button onclick="addItem(this)">Ürün Ekle</button>
          <button class="remove-btn" onclick="removeCategory(this)">Kategoriyi Sil</button>
        `;

        const itemsDiv = catDiv.querySelector(".items");
        menuData[category].items.forEach(item => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";
          itemDiv.innerHTML = `
            <input type="text" placeholder="Ürün Adı" value="${item.name}" data-name>
            <input type="text" placeholder="Açıklama" value="${item.description}" data-description>
            <input type="text" placeholder="Fiyat" value="${item.price}" data-price>
            <input type="text" placeholder="Fotoğraf URL" value="${item.photo}" data-photo>
            <button class="remove-btn" onclick="removeItem(this)">Ürünü Sil</button>
          `;
          itemsDiv.appendChild(itemDiv);
        });

        container.appendChild(catDiv);
      }
    }

    function addCategory() {
      const catDiv = document.createElement("div");
      catDiv.className = "category";
      catDiv.innerHTML = `
        <input type="text" placeholder="Kategori Adı" data-category>
        <input type="text" placeholder="Kategori Görseli" data-image>
        <div class="items"></div>
        <button onclick="addItem(this)">Ürün Ekle</button>
        <button class="remove-btn" onclick="removeCategory(this)">Kategoriyi Sil</button>
      `;
      document.getElementById("menuContainer").appendChild(catDiv);
    }

    function addItem(btn) {
      const itemsDiv = btn.parentElement.querySelector(".items");
      const itemDiv = document.createElement("div");
      itemDiv.className = "item";
      itemDiv.innerHTML = `
        <input type="text" placeholder="Ürün Adı" data-name>
        <input type="text" placeholder="Açıklama" data-description>
        <input type="text" placeholder="Fiyat" data-price>
        <input type="text" placeholder="Fotoğraf URL" data-photo>
        <button class="remove-btn" onclick="removeItem(this)">Ürünü Sil</button>
      `;
      itemsDiv.appendChild(itemDiv);
    }

    function removeItem(btn) {
      btn.parentElement.remove();
    }

    function removeCategory(btn) {
      btn.parentElement.remove();
    }

    async function saveMenu() {
      const data = {};
      const categories = document.querySelectorAll(".category");

      categories.forEach(cat => {
        const catName = cat.querySelector("[data-category]").value.trim();
        const image = cat.querySelector("[data-image]").value.trim();
        const items = [];
        cat.querySelectorAll(".item").forEach(item => {
          items.push({
            name: item.querySelector("[data-name]").value.trim(),
            description: item.querySelector("[data-description]").value.trim(),
            price: item.querySelector("[data-price]").value.trim(),
            photo: item.querySelector("[data-photo]").value.trim()
          });
        });
        if (catName) {
          data[catName] = { image, items };
        }
      });

      const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
        method: "PUT",
        headers: {
          Authorization: "token " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Menü güncellendi",
          content: btoa(JSON.stringify(data, null, 2)),
          sha,
          branch: BRANCH
        })
      });

      if (!res.ok) {
        document.getElementById("status").innerText = "Hata: " + res.statusText;
        return;
      }
      const result = await res.json();
      sha = result.content.sha;
      document.getElementById("status").innerText = "Menü başarıyla güncellendi.";
    }

    loadMenu();
  </script>
</body>
</html>
